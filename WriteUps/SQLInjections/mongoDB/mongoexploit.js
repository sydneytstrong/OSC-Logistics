var express = require('express');
var bodyParser = require('body-parser');
var app = express();
var path = require('path');
app.use(bodyParser.urlencoded({extended: true}));

var MongoClient = require('mongodb').MongoClient;
var url = "mongodb://localhost:27017/";


app.get('/', function(req,res){
        res.sendFile(path.join(__dirname+'/demofile1.html'));
});

app.post('/', function(req, res){
        //name = req.body.name_field;

	MongoClient.connect(url, function(err, db) {
		if(err) throw err;
		console.log("Connected!");
		var dbo = db.db("mydb");
		var query = { 
			$where: "this.name === '" + req.body.name_field + "'"
		};
	dbo.collection("customers").find(query).toArray(function(err, result){
		if (err) throw err;
		console.log(result);
		res.send(result);
		});
		db.close();
	});
	
});

app.listen(process.env.port || 8080);
console.log('Running on port 8080');
